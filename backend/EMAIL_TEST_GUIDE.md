# üìß Email Service Testing Guide

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•

‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏°‡∏µ 2 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:

1. **Admin Notification Email** - ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ admin ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
2. **Customer Confirmation Email** - ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå `.env` ‡πÉ‡∏ô `mticket/backend/` ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

```env
# Email Configuration
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
ADMIN_EMAIL=admin@example.com

# Optional: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö
TEST_CUSTOMER_EMAIL=test@example.com
```

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gmail:
1. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 2-Step Verification
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á App Password ‡∏ó‡∏µ‡πà: https://myaccount.google.com/apppasswords
3. ‡πÉ‡∏ä‡πâ App Password (16 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£) ‡πÅ‡∏ó‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥

## ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ Script ‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

```bash
cd mticket/backend
npm run test-email
```

‡∏´‡∏£‡∏∑‡∏≠

```bash
node test-email.js
```

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ email
- ‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ SMTP server
- ‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ admin
- ‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ customer

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ API Endpoint

**Endpoint:** `POST /api/email/test`

**Headers:**
```
X-API-Key: your-api-key
Content-Type: application/json
```

**Request Body:**
```json
{
  "testType": "both",  // "admin", "customer", ‡∏´‡∏£‡∏∑‡∏≠ "both"
  "customerEmail": "test@example.com"  // optional
}
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ curl:**
```bash
curl -X POST http://localhost:5000/api/email/test \
  -H "X-API-Key: your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "testType": "both",
    "customerEmail": "test@example.com"
  }'
```

**Response:**
```json
{
  "success": true,
  "message": "Email test completed successfully",
  "results": {
    "connection": true,
    "adminEmail": {
      "success": true,
      "messageId": "..."
    },
    "customerEmail": {
      "success": true,
      "messageId": "..."
    }
  }
}
```

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô Webhook ‡∏à‡∏£‡∏¥‡∏á

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:
1. **Admin Email** - ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà `ADMIN_EMAIL`
2. **Customer Email** - ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡πÉ‡∏ô console:
```
[Webhook] ‚úÖ Admin email notification sent
[Webhook] ‚úÖ Customer confirmation email sent to: customer@example.com
```

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Connection Failed

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:**
- ‚ùå `EMAIL_HOST`, `EMAIL_PORT` ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚ùå `EMAIL_USER`, `EMAIL_PASSWORD` ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‚ùå Firewall/Network block SMTP port
- ‚ùå Gmail: ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ App Password

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `.env` file
2. ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Gmail: ‡πÉ‡∏ä‡πâ App Password ‡πÅ‡∏ó‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö network/firewall settings

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Admin Email ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:**
- ‚ùå `ADMIN_EMAIL` ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
- ‚ùå Email server reject recipient

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ `ADMIN_EMAIL` ‡πÉ‡∏ô `.env`
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ email address ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Customer Email ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:**
- ‚ùå Customer email ‡πÄ‡∏õ‡πá‡∏ô "N/A" ‡∏´‡∏£‡∏∑‡∏≠ invalid
- ‚ùå Email server reject recipient

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ customer email ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡πÉ‡∏ô console

## Email Templates

### Admin Notification Email
- **Subject:** `üé´ New Booking - {Stadium} - {Customer Name}`
- **Content:** ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- **Recipient:** `ADMIN_EMAIL`

### Customer Confirmation Email
- **Subject:** `‚úÖ Payment Confirmed - Booking Reference: {Reference No}`
- **Content:** ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á + ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á success page
- **Recipient:** Customer email

## ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Email ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß

1. **Admin Email:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö inbox ‡∏Ç‡∏≠‡∏á `ADMIN_EMAIL` (‡πÅ‡∏•‡∏∞ spam folder)
2. **Customer Email:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö inbox ‡∏Ç‡∏≠‡∏á customer (‡πÅ‡∏•‡∏∞ spam folder)

## Logs

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡πÉ‡∏ô console ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•:

```
[EmailService] Sending booking notification to admin...
[EmailService] Recipient: admin@example.com
[EmailService] Email sent successfully!
[EmailService] Message ID: <message-id>
```

## ‡∏™‡∏£‡∏∏‡∏õ

‚úÖ **‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô** ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
- Environment variables ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- SMTP connection ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- Admin ‡πÅ‡∏•‡∏∞ Customer email ‡∏™‡πà‡∏á‡πÑ‡∏î‡πâ

‚ùå **‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç** ‡πÄ‡∏°‡∏∑‡πà‡∏≠:
- Connection failed
- Email ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á
- Email ‡πÑ‡∏õ‡∏ó‡∏µ‡πà spam folder (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SPF/DKIM records)
